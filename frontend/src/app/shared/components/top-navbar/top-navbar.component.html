<nav *ngIf="!isAdminRoute()" class="fixed top-0 left-0 right-0 z-[100] transition-all duration-300 bg-white"
    [class.shadow-sm]="isScrolled" [style.transform]="showNav ? 'translateY(0)' : 'translateY(-100%)'">

    <div class="navbar-container px-4 sm:px-6">
        <div class="flex items-center justify-between h-16 md:h-16">

            <!-- Left Side: Hamburger & Logo -->
            <div class="flex items-center gap-3">
                <!-- Hamburger Button (Mobile Only) -->
                <button (click)="toggleHamburger()"
                    class="lg:hidden p-1.5 hover:bg-slate-100 rounded-lg text-slate-600 transition-colors">
                    <i class="fas fa-bars text-xl"></i>
                </button>

                <!-- Logo & Brand (Hidden on Mobile, Visible on Desktop) -->
                <a routerLink="/" class="hidden lg:flex items-center gap-2 group">
                    <i
                        class="fas fa-heartbeat text-emerald-500 text-3xl group-hover:scale-110 transition-transform"></i>
                    <div>
                        <h1 class="text-2xl font-black tracking-tighter">
                            <span class="text-slate-900">Health</span><span class="text-emerald-500">Connect</span>
                        </h1>
                    </div>
                </a>

                <div class="h-8 w-[1px] bg-slate-200 mx-2 hidden lg:block"></div>

                <!-- Location Selector (Desktop) -->
                <div class="hidden lg:block">
                    <app-location-selector></app-location-selector>
                </div>
            </div>

            <!-- Center: Navigation Links -->
            <div class="hidden lg:flex items-center gap-7">
                <!-- Home -->
                <a routerLink="/" class="nav-link text-slate-800 hover:text-emerald-600 transition-colors">
                    {{ 'nav.home' | translate }}
                </a>

                <!-- Shop Dropdown -->
                <div class="relative shop-dropdown-container">
                    <button (click)="toggleShopDropdown()"
                        class="nav-link text-slate-800 hover:text-emerald-600 transition-colors flex items-center gap-2">
                        {{ 'nav.shop' | translate }}
                        <i [class]="shopDropdownOpen ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"
                            class="text-[10px]"></i>
                    </button>
                    <!-- Shop Dropdown Menu -->
                    <div *ngIf="shopDropdownOpen"
                        class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-60 glass rounded-2xl shadow-2xl p-2 animate-fade-in-up z-[110]">
                        <a routerLink="/medicines" (click)="shopDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-pills text-teal-600 w-5"></i>
                            <span class="text-sm font-medium text-slate-700">{{ 'nav.medicines' | translate }}</span>
                        </a>
                        <a routerLink="/medical-devices" (click)="shopDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-laptop-medical text-blue-600 w-5"></i>
                            <span class="text-sm font-medium text-slate-700">{{ 'nav.devices' | translate }}</span>
                        </a>
                        <a routerLink="/lab-tests" (click)="shopDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-microscope text-indigo-600 w-5"></i>
                            <span class="text-sm font-medium text-slate-700">{{ 'nav.lab_tests' | translate }}</span>
                        </a>
                        <a routerLink="/health-plans" (click)="shopDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-shield-heart text-pink-600 w-5"></i>
                            <span class="text-sm font-medium text-slate-700">{{ 'nav.plans' | translate }}</span>
                        </a>
                    </div>
                </div>

                <!-- Find Care Dropdown -->
                <div class="relative care-dropdown-container">
                    <button (click)="toggleCareDropdown()"
                        class="nav-link text-slate-800 hover:text-emerald-600 transition-colors flex items-center gap-2">
                        {{ 'nav.find_care' | translate }}
                        <i [class]="careDropdownOpen ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"
                            class="text-[10px]"></i>
                    </button>
                    <div *ngIf="careDropdownOpen"
                        class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-60 glass rounded-2xl shadow-2xl p-2 animate-fade-in-up z-[110]">
                        <a routerLink="/find-doctors" (click)="careDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-user-md text-emerald-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">{{ 'nav.doctors' | translate }}</span>
                        </a>
                        <a routerLink="/hospitals" (click)="careDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-hospital text-red-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">{{ 'nav.hospitals' | translate }}</span>
                        </a>
                        <a routerLink="/pharmacies" (click)="careDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                            <i class="fas fa-prescription-bottle-alt text-teal-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">{{ 'nav.pharmacies' | translate }}</span>
                        </a>
                        <a routerLink="/nearby-services" (click)="careDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all border-t border-slate-50 mt-1">
                            <i class="fas fa-map-marked-alt text-emerald-600 w-5"></i>
                            <span class="text-sm font-black text-emerald-700">{{ 'nav.nearby' | translate }}</span>
                        </a>
                    </div>
                </div>

                <!-- My Health (If logged in) -->
                <div *ngIf="isLoggedIn" class="relative my-health-dropdown-container">
                    <button (click)="toggleMyHealthDropdown()"
                        class="nav-link text-slate-800 hover:text-emerald-600 transition-colors flex items-center gap-2">
                        {{ 'nav.my_health' | translate }}
                        <i [class]="myHealthDropdownOpen ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"
                            class="text-[10px]"></i>
                    </button>
                    <div *ngIf="myHealthDropdownOpen"
                        class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-60 glass rounded-2xl shadow-2xl p-2 animate-fade-in-up z-[110]">
                        <a (click)="navigateToDashboard()"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-columns text-emerald-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">{{ 'nav.dashboard' | translate }}</span>
                        </a>
                        <a (click)="navigateToOrders()"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-box text-orange-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">{{ 'nav.orders' | translate }}</span>
                        </a>
                        <a (click)="navigateToProfile()"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-id-card text-purple-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">{{ 'nav.profile' | translate }}</span>
                        </a>
                        <a routerLink="/appointments/video" (click)="myHealthDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-video text-rose-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">My Appointments</span>
                        </a>
                        <a routerLink="/wellness/calendar" (click)="myHealthDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-calendar-alt text-emerald-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">Wellness Calendar</span>
                        </a>
                        <a routerLink="/feedback" (click)="myHealthDropdownOpen = false"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-comment-alt text-emerald-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">Share Feedback</span>
                        </a>
                        <a (click)="navigateToBilling()"
                            class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all cursor-pointer">
                            <i class="fas fa-credit-card text-emerald-600 w-5"></i>
                            <span class="text-sm font-bold text-slate-700">Billing & Plans</span>
                        </a>
                    </div>
                </div>

                <!-- Nearby Services -->
                <!-- <a routerLink="/nearby-services" (click)="careDropdownOpen = false"
                    class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all border-t border-slate-50 mt-1">
                    <i class="fas fa-map-marked-alt text-emerald-600 w-5"></i>
                    <span class="text-sm font-black text-emerald-700">Nearby Care</span>
                </a> -->
            </div>

            <!-- Right: Utilities & User Profile -->
            <div class="flex items-center gap-2 sm:gap-4">
                <!-- ADD SOS HERE -->
                <a routerLink="/emergency"
                    class="hidden md:block px-4 py-1.5 bg-red-50 text-red-600 rounded-xl text-sm font-black hover:bg-red-600 hover:text-white transition-all animate-pulse shadow-sm">
                    {{ 'nav.emergency' | translate }}
                </a>

                <!-- Install App Button -->
                <button *ngIf="showInstallButton$ | async" (click)="installApp()"
                    class="hidden md:flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-600 rounded-xl text-sm font-bold hover:bg-emerald-600 hover:text-white transition-all shadow-sm">
                    <i class="fas fa-download"></i>
                </button>

                <!-- Search Trigger -->
                <button (click)="toggleSearchOverlay()"
                    class="p-2.5 hover:bg-slate-100 rounded-xl text-slate-600 transition-all" aria-label="Search">
                    <i class="fas fa-search text-xl"></i>
                </button>

                <!-- Cart -->
                <button *ngIf="isLoggedIn" (click)="toggleCartSidebar()"
                    class="relative p-2.5 hover:bg-slate-100 rounded-xl text-slate-600 transition-all"
                    aria-label="Cart">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span *ngIf="cartCount > 0"
                        class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-white shadow-sm">
                        {{ cartCount }}
                    </span>
                </button>

                <!-- Notifications -->
                <app-notification-bell *ngIf="isLoggedIn"></app-notification-bell>

                <!-- User Profile -->
                <div class="relative profile-menu-container ml-2">
                    <button (click)="toggleProfileMenu()"
                        class="flex items-center justify-center w-10 h-10 rounded-full bg-gradient-calm text-white font-bold text-sm shadow-md hover:scale-105 transition-transform overflow-hidden">
                        <img *ngIf="isLoggedIn && userAvatar" [src]="userAvatar" [alt]="userName"
                            class="w-full h-full object-cover">
                        <span *ngIf="!userAvatar">{{ isLoggedIn ? getUserInitials() : '?' }}</span>
                    </button>

                    <!-- Profile Dropdown -->
                    <div *ngIf="profileMenuOpen"
                        class="absolute top-full right-0 mt-4 w-56 glass rounded-2xl shadow-2xl overflow-hidden animate-fade-in-up z-[110]">
                        <ng-container *ngIf="isLoggedIn; else guestMenu">
                            <div class="px-5 py-4 border-b border-slate-50 bg-slate-50/50">
                                <p class="text-sm font-bold text-slate-900 truncate">{{userName}}</p>
                                <p class="text-[10px] text-slate-500 font-medium uppercase tracking-wider mt-0.5">{{
                                    'nav.profile' | translate }}</p>
                            </div>
                            <div class="py-2">
                                <button (click)="navigateToDashboard()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-home w-4 text-center text-emerald-600"></i>
                                    {{ 'nav.dashboard' | translate }}
                                </button>
                                <button (click)="navigateToProfile()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-user-circle w-4 text-center text-emerald-600"></i>
                                    {{ 'nav.profile' | translate }}
                                </button>
                                <button (click)="navigateToOrders()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-shopping-bag w-4 text-center text-emerald-600"></i>
                                    {{ 'nav.orders' | translate }}
                                </button>
                                <button routerLink="/appointments/video" (click)="profileMenuOpen = false"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-video w-4 text-center text-rose-600"></i>
                                    My Appointments
                                </button>
                                <button (click)="navigateToProfile('reviews')"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-star w-4 text-center text-amber-500"></i>
                                    My Reviews
                                </button>
                                <button (click)="navigateToFavorites()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-heart w-4 text-center text-red-500"></i>
                                    {{ 'nav.favorites' | translate }}
                                </button>
                                <button (click)="navigateToBilling()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-credit-card w-4 text-center text-emerald-600"></i>
                                    Billing & Plans
                                </button>
                            </div>
                            <div class="py-2 border-t border-slate-50">
                                <button (click)="navigateToSettings()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-slate-700 hover:bg-emerald-50 hover:text-emerald-600 transition-colors flex items-center gap-3">
                                    <i class="fas fa-cog w-4 text-center text-slate-400"></i>
                                    {{ 'nav.settings' | translate }}
                                </button>
                                <button (click)="logout()"
                                    class="w-full text-left px-5 py-2.5 text-sm font-bold text-red-600 hover:bg-red-50 transition-colors flex items-center gap-3">
                                    <i class="fas fa-sign-out-alt w-4 text-center"></i>
                                    {{ 'nav.logout' | translate }}
                                </button>
                            </div>
                        </ng-container>
                        <ng-template #guestMenu>
                            <div class="p-2">
                                <a routerLink="/for-users" (click)="profileMenuOpen = false"
                                    class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all">
                                    <i class="fas fa-user text-emerald-600"></i>
                                    <span class="text-sm font-medium text-slate-700">{{ 'nav.patient_login' | translate
                                        }}</span>
                                </a>
                                <a routerLink="/for-doctors" (click)="profileMenuOpen = false"
                                    class="flex items-center gap-3 px-4 py-3 hover:bg-emerald-50 rounded-xl transition-all border-t border-slate-50">
                                    <i class="fas fa-user-md text-emerald-600"></i>
                                    <span class="text-sm font-medium text-slate-700">{{ 'nav.doctor_login' | translate
                                        }}</span>
                                </a>
                            </div>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Spacer for fixed navbar -->
<div *ngIf="!isAdminRoute()" class="h-16 md:h-16"></div>

<!-- Search Overlay -->
<div *ngIf="showSearchOverlay"
    class="fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-md flex items-start justify-center pt-20 animate-fade-in"
    (click)="toggleSearchOverlay()">

    <div (click)="$event.stopPropagation()" class="w-full max-w-3xl mx-4 animate-scale-in">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <!-- Search Input Area -->
            <div class="p-4 md:p-6 border-b border-slate-100">
                <!-- Mobile only: Close button top-left -->
                <!-- <div class="md:hidden flex justify-end">
                    <button (click)="toggleSearchOverlay()" class="p-2 text-slate-400 hover:text-slate-600">
                        <i class="fas fa-times text-base"></i>
                    </button>
                </div> -->

                <div class="flex flex-col md:flex-row md:items-center w-full gap-4">
                    <!-- Search Input Container -->
                    <div class="relative flex items-center flex-1">
                        <i class="fas fa-search absolute left-4 md:left-5 text-slate-400 text-base md:text-xl"></i>
                        <input id="search-overlay-input" type="text" [(ngModel)]="searchQuery" (input)="onSearchInput()"
                            (keyup.enter)="performSearch()" [placeholder]="'search.placeholder' | translate"
                            class="w-full pl-11 md:pl-14 pr-10 md:pr-12 py-3 md:py-5 bg-slate-50 border-none rounded-xl md:rounded-2xl focus:ring-2 focus:ring-emerald-500 text-base md:text-lg text-slate-900 placeholder-slate-400 transition-all">

                        <!-- Clear Field Button -->
                        <button *ngIf="searchQuery" (click)="clearSearchQuery()"
                            class="absolute right-3 md:right-4 p-1 text-slate-300 hover:text-slate-500 transition-colors">
                            <i class="fas fa-times-circle text-lg md:text-xl"></i>
                        </button>
                    </div>

                    <!-- Desktop only: Close button next to input -->
                    <button (click)="toggleSearchOverlay()"
                        class="hidden md:flex p-2 text-slate-400 hover:text-slate-600 transition-all">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
            </div>

            <!-- Suggestions / History Area -->
            <div class="max-h-[60vh] overflow-y-auto custom-scrollbar p-6">
                <!-- Autocomplete Suggestions -->
                <div *ngIf="searchQuery.length >= 2 && suggestions.length > 0">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 px-2">
                        {{ 'search.suggestions' | translate }}
                    </h3>
                    <div class="grid grid-cols-1 gap-2">
                        <button *ngFor="let item of suggestions" (click)="selectSuggestion(item)"
                            class="flex items-center justify-between p-1.5 md:p-4 hover:bg-emerald-50 rounded-2xl transition-all group">
                            <div
                                class="flex-1 flex flex-nowrap items-center md:justify-between justify-start gap-1 md:gap-2 min-w-0">
                                <div class="flex items-center gap-1.5 md:gap-4 min-w-0">
                                    <!-- Desktop: Original Gray Box with Generic Icon -->
                                    <div
                                        class="hidden md:flex w-10 h-10 bg-slate-100 rounded-xl flex-shrink-0 items-center justify-center group-hover:bg-emerald-100 transition-colors">
                                        <i class="fas fa-search text-slate-400 group-hover:text-emerald-600"></i>
                                    </div>

                                    <!-- Mobile: Contextual Colored Icon -->
                                    <i
                                        [class]="'fas ' + getTypeIcon(item.product_type) + ' ' + getTypeIconColor(item.product_type) + ' md:hidden flex-shrink-0 w-5 text-center text-base'"></i>
                                    <span
                                        class="text-slate-700 font-bold md:font-medium text-[13px] md:text-base truncate">
                                        {{ item.name }}
                                    </span>
                                </div>
                                <span
                                    class="text-[9px] md:text-[10px] text-slate-400 uppercase font-bold flex-shrink-0 bg-slate-50 px-2 py-0.5 rounded shadow-sm">
                                    {{ item.product_type }}
                                </span>
                            </div>
                            <!-- Arrow only on Desktop -->
                            <i
                                class="hidden md:block fas fa-arrow-right text-slate-300 group-hover:text-emerald-500 opacity-0 group-hover:opacity-100 transition-all translate-x-[-10px] group-hover:translate-x-0">
                            </i>
                        </button>
                    </div>
                </div>

                <!-- Recent Searches -->
                <div *ngIf="searchQuery.length === 0 && searchHistory.length > 0">
                    <div class="flex items-center justify-between mb-4 px-2">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">{{ 'search.recent' |
                            translate }}</h3>
                        <button (click)="clearHistory()" class="text-xs font-bold text-red-500 hover:text-red-600">{{
                            'search.clear' | translate }}</button>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button *ngFor="let term of searchHistory" (click)="searchFromHistory(term)"
                            class="px-5 py-2.5 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-full text-sm font-medium flex items-center gap-2 transition-all">
                            <i class="fas fa-history text-slate-300"></i>
                            {{ term }}
                        </button>
                    </div>
                </div>

                <!-- Popular Searches -->
                <!-- <div *ngIf="searchQuery.length === 0 && popularSearches.length > 0" class="mt-8">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 px-2">{{ 'search.popular'
                        | translate }}
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <button *ngFor="let term of popularSearches" (click)="searchPopular(term)"
                            class="flex items-center gap-3 p-4 bg-emerald-50/50 hover:bg-emerald-50 text-emerald-700 rounded-2xl transition-all text-left">
                            <i class="fas fa-fire text-orange-500"></i>
                            <span class="text-sm font-semibold">{{ term }}</span>
                        </button>
                    </div>
                </div> -->

                <!-- No Results Empty State -->
                <div *ngIf="searchQuery.length >= 2 && suggestions.length === 0" class="py-6 px-4">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-search-minus text-3xl text-slate-300"></i>
                        </div>
                        <p class="text-slate-500 font-medium">{{ 'search.no_results' | translate }} "{{ searchQuery }}"
                        </p>
                        <p class="text-sm text-slate-400 mt-1">Try checking your spelling or use more general terms.</p>
                    </div>

                    <div class="border-t border-slate-100 pt-8">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 px-2">Popular
                            Categories</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            <a routerLink="/medicines" (click)="toggleSearchOverlay()"
                                class="flex flex-col items-center p-4 bg-slate-50 hover:bg-emerald-50 rounded-2xl transition-all group">
                                <i
                                    class="fas fa-pills text-emerald-600 mb-2 text-xl group-hover:scale-110 transition-transform"></i>
                                <span class="text-sm font-semibold text-slate-700">Medicines</span>
                            </a>
                            <a routerLink="/find-doctors" (click)="toggleSearchOverlay()"
                                class="flex flex-col items-center p-4 bg-slate-50 hover:bg-emerald-50 rounded-2xl transition-all group">
                                <i
                                    class="fas fa-user-md text-blue-600 mb-2 text-xl group-hover:scale-110 transition-transform"></i>
                                <span class="text-sm font-semibold text-slate-700">Doctors</span>
                            </a>
                            <a routerLink="/lab-tests" (click)="toggleSearchOverlay()"
                                class="flex flex-col items-center p-4 bg-slate-50 hover:bg-emerald-50 rounded-2xl transition-all group">
                                <i
                                    class="fas fa-flask text-indigo-600 mb-2 text-xl group-hover:scale-110 transition-transform"></i>
                                <span class="text-sm font-semibold text-slate-700">Lab Tests</span>
                            </a>
                            <a routerLink="/ayurveda" (click)="toggleSearchOverlay()"
                                class="flex flex-col items-center p-4 bg-slate-50 hover:bg-emerald-50 rounded-2xl transition-all group">
                                <i
                                    class="fas fa-leaf text-emerald-600 mb-2 text-xl group-hover:scale-110 transition-transform"></i>
                                <span class="text-sm font-semibold text-slate-700">Ayurveda</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cart Sidebar -->
<!-- Removed for now -->
<div *ngIf="showCartSidebar" class="fixed inset-0 z-[110] flex justify-end" (click)="toggleCartSidebar()">
    <!-- Backdrop Overlay -->
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm animate-fade-in"></div>

    <!-- Sidebar Content -->
    <div (click)="$event.stopPropagation()"
        class="relative w-full max-w-md bg-white h-full shadow-2xl animate-slide-in-right flex flex-col">

        <!-- Header -->
        <div class="p-6 border-b border-slate-100 flex items-center justify-between">
            <h2 class="text-xl font-black text-slate-900 flex items-center gap-3">
                <i class="fas fa-shopping-basket text-emerald-500"></i>
                {{ 'cart.title' | translate }}
            </h2>
            <button (click)="toggleCartSidebar()" class="p-2 hover:bg-slate-100 rounded-xl transition-all">
                <i class="fas fa-times text-slate-400"></i>
            </button>
        </div>

        <!-- Cart Items -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-6">
            <div *ngIf="cart?.items?.length > 0; else emptyCart" class="space-y-6">
                <div *ngFor="let item of cart.items" class="flex gap-4 group">
                    <div
                        class="w-20 h-20 bg-slate-50 rounded-2xl overflow-hidden flex-shrink-0 flex items-center justify-center p-2 border border-slate-100">
                        <img [src]="getImageUrl(item.image)" [alt]="item.name"
                            class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-500">
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="text-sm font-bold text-slate-800 line-clamp-1">{{ item.name }}</h3>
                            <button (click)="removeFromCart(item.id)"
                                class="text-slate-300 hover:text-red-500 transition-colors">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                        <p class="text-xs text-slate-400 mb-3 capitalize">{{ item.product_type || 'Product' }}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center bg-slate-50 rounded-lg p-1">
                                <button (click)="updateCartQuantity(item.id, item.quantity - 1)"
                                    class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-emerald-500 transition-colors">
                                    <i class="fas fa-minus text-[10px]"></i>
                                </button>
                                <span class="w-8 text-center text-xs font-bold text-slate-700">{{ item.quantity
                                    }}</span>
                                <button (click)="updateCartQuantity(item.id, item.quantity + 1)"
                                    class="w-6 h-6 flex items-center justify-center text-slate-400 hover:text-emerald-500 transition-colors">
                                    <i class="fas fa-plus text-[10px]"></i>
                                </button>
                            </div>
                            <span class="text-sm font-black text-slate-900">₹{{ (item.price * item.quantity).toFixed(2)
                                }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <ng-template #emptyCart>
                <div class="h-full flex flex-col items-center justify-center text-center py-12">
                    <div class="w-24 h-24 bg-emerald-50 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-shopping-cart text-3xl text-emerald-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2">{{ 'cart.empty' | translate }}</h3>
                    <p class="text-sm text-slate-500 mb-8 max-w-[200px]">{{ 'cart.empty_desc' | translate }}</p>
                    <button (click)="toggleCartSidebar()"
                        class="px-8 py-3 bg-emerald-500 text-white rounded-2xl font-bold shadow-lg shadow-emerald-200 hover:bg-emerald-600 transition-all">
                        {{ 'cart.start_shopping' | translate }}
                    </button>
                </div>
            </ng-template>
        </div>

        <!-- Footer -->
        <div *ngIf="cart?.items?.length > 0" class="p-6 bg-slate-50 border-t border-slate-100 space-y-4">
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-500 font-medium">{{ 'cart.subtotal' | translate }}</span>
                    <span class="text-slate-900 font-bold">₹{{ cart.subtotal.toFixed(2) }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-500 font-medium">{{ 'cart.delivery' | translate }}</span>
                    <span class="text-slate-900 font-bold" [class.text-emerald-600]="cart.delivery === 0">
                        {{ cart.delivery === 0 ? ('cart.free' | translate) : '₹' + cart.delivery.toFixed(2) }}
                    </span>
                </div>
                <div class="flex justify-between text-lg pt-2 border-t border-slate-200">
                    <span class="text-slate-900 font-black">{{ 'cart.total' | translate }}</span>
                    <span class="text-emerald-600 font-black">₹{{ cart.total.toFixed(2) }}</span>
                </div>
            </div>
            <button routerLink="/cart" (click)="toggleCartSidebar()"
                class="w-full py-4 bg-emerald-500 text-white rounded-2xl font-black shadow-xl shadow-emerald-200 hover:bg-emerald-600 transition-all flex items-center justify-center gap-3">
                {{ 'cart.checkout' | translate }}
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- Backdrop for closing dropdowns -->
<div *ngIf="shopDropdownOpen || careDropdownOpen || myHealthDropdownOpen || profileMenuOpen"
    (click)="closeAllDropdowns()" class="fixed inset-0 z-[90] bg-black/5 backdrop-blur-[1px]">
</div>