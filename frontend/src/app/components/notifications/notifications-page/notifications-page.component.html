<!-- Notifications Page -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-6">
    <div class="max-w-4xl mx-auto">

        <!-- Header -->
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                <i class="fa-solid fa-bell text-emerald-600"></i>
                Notifications
            </h1>
            <p class="text-gray-600 mt-1">Stay updated with all your health activities</p>
        </div>

        <!-- Filters & Actions Bar -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                <!-- Filters -->
                <div class="flex flex-wrap gap-3 items-center">
                    <!-- Category Filter -->
                    <select [(ngModel)]="filters.category" (change)="onFilterChange()"
                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                        <option *ngFor="let cat of categories" [value]="cat.value">
                            {{ cat.label }}
                        </option>
                    </select>

                    <!-- Unread Only Toggle -->
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" [(ngModel)]="filters.unreadOnly" (change)="onFilterChange()"
                            class="w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500">
                        <span class="text-sm text-gray-700">Unread only</span>
                    </label>
                </div>

                <!-- Actions -->
                <button (click)="markAllAsRead()" *ngIf="unreadCount > 0"
                    class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-check-double"></i>
                    Mark All as Read
                </button>
            </div>
        </div>

        <!-- Unread Count Badge -->
        <div *ngIf="unreadCount > 0" class="mb-4">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-2">
                <i class="fa-solid fa-info-circle text-blue-600"></i>
                <span class="text-sm text-blue-800">
                    You have <strong>{{ unreadCount }}</strong> unread notification{{ unreadCount > 1 ? 's' : '' }}
                </span>
            </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading && notifications.length === 0" class="text-center py-12">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-emerald-600 mb-3"></i>
            <p class="text-gray-600">Loading notifications...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && notifications.length === 0"
            class="bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center">
            <i class="fa-solid fa-bell-slash text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No Notifications</h3>
            <p class="text-gray-600">
                <span *ngIf="filters.unreadOnly">No unread notifications</span>
                <span *ngIf="!filters.unreadOnly">You're all caught up!</span>
            </p>
        </div>

        <!-- Notifications List -->
        <div *ngIf="!loading && notifications.length > 0" class="space-y-3">
            <div *ngFor="let notification of notifications" [routerLink]="notification.action_url || null"
                class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 hover:shadow-md transition-all cursor-pointer"
                [class.bg-blue-50]="!notification.is_read" [class.border-blue-200]="!notification.is_read"
                (click)="markAsRead(notification)">

                <div class="flex items-start gap-4">
                    <!-- Icon -->
                    <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center" [ngClass]="{
                            'bg-green-100': notification.type.includes('approved') || notification.type.includes('verified'),
                            'bg-red-100': notification.type.includes('rejected') || notification.type.includes('failed'),
                            'bg-yellow-100': notification.type.includes('reminder') || notification.type.includes('expiring'),
                            'bg-blue-100': !notification.type.includes('approved') && !notification.type.includes('rejected') && !notification.type.includes('reminder')
                        }">
                        <i class="fa-solid text-lg"
                            [ngClass]="notificationService.getNotificationIcon(notification.type)"
                            [class]="notificationService.getNotificationColor(notification.type)"></i>
                    </div>

                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-start justify-between mb-1">
                            <h4 class="text-base font-semibold text-gray-900" [class.font-bold]="!notification.is_read">
                                {{ notification.title }}
                            </h4>
                            <div class="flex items-center gap-2 ml-2">
                                <span *ngIf="!notification.is_read"
                                    class="flex-shrink-0 w-2.5 h-2.5 bg-blue-600 rounded-full"></span>
                                <button (click)="deleteNotification(notification, $event)"
                                    class="text-gray-400 hover:text-red-600 transition-colors">
                                    <i class="fa-solid fa-trash text-sm"></i>
                                </button>
                            </div>
                        </div>

                        <p class="text-sm text-gray-700 mb-2">
                            {{ notification.message }}
                        </p>

                        <div class="flex items-center gap-3 text-xs text-gray-500">
                            <span class="flex items-center gap-1">
                                <i class="fa-solid fa-clock"></i>
                                {{ timeAgo(notification.created_at) }}
                            </span>
                            <span class="flex items-center gap-1">
                                <i class="fa-solid fa-tag"></i>
                                {{ notification.category | titlecase }}
                            </span>
                            <span *ngIf="notification.priority === 'high'" class="flex items-center gap-1 text-red-600">
                                <i class="fa-solid fa-exclamation-circle"></i>
                                High Priority
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Load More -->
        <div *ngIf="notifications.length > 0 && notifications.length < totalCount" class="mt-6 text-center">
            <button (click)="loadMore()" [disabled]="loading"
                class="px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fa-solid" [class.fa-spinner]="loading" [class.fa-spin]="loading"
                    [class.fa-arrow-down]="!loading"></i>
                Load More
            </button>
        </div>

    </div>
</div>