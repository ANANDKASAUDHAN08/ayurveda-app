<div class="h-screen flex flex-col bg-slate-50 overflow-hidden font-sans">

    <!-- Loading Skeleton -->
    <div *ngIf="isLoadingProfile" class="h-screen flex flex-col bg-slate-50 overflow-hidden">
        <!-- Header Skeleton -->
        <header class="shrink-0 bg-white border-b border-slate-200 shadow-sm">
            <div class="px-8 py-4 bg-gradient-to-r from-emerald-900 to-teal-900">
                <div class="flex items-center gap-4">
                    <div class="h-16 w-16 rounded-xl bg-white/20 animate-pulse"></div>
                    <div class="space-y-2">
                        <div class="h-6 w-32 bg-white/20 rounded animate-pulse"></div>
                        <div class="h-4 w-44 bg-white/10 rounded animate-pulse"></div>
                    </div>
                </div>
            </div>
            <div class="px-8 flex gap-8 bg-white py-4">
                <div class="h-4 w-24 bg-slate-200 rounded animate-pulse"></div>
                <div class="h-4 w-24 bg-slate-200 rounded animate-pulse"></div>
                <div class="h-4 w-20 bg-slate-200 rounded animate-pulse"></div>
            </div>
        </header>

        <!-- Content Skeleton -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar Skeleton -->
            <aside class="w-80 bg-slate-50 border-r border-slate-200 hidden lg:block p-6">
                <div class="bg-white rounded-xl p-5 space-y-4">
                    <div class="h-4 w-20 bg-slate-200 rounded animate-pulse"></div>
                    <div class="h-12 bg-slate-100 rounded animate-pulse"></div>
                    <div class="h-12 bg-slate-100 rounded animate-pulse"></div>
                    <div class="h-12 bg-slate-100 rounded animate-pulse"></div>
                </div>
            </aside>

            <!-- Main Content Skeleton -->
            <main class="flex-1 overflow-y-auto p-10">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                    <div class="px-8 py-6 border-b border-slate-100">
                        <div class="h-6 w-48 bg-slate-200 rounded animate-pulse"></div>
                    </div>
                    <div class="p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="space-y-2" *ngFor="let i of [1,2,3,4,5,6]">
                            <div class="h-3 w-16 bg-slate-200 rounded animate-pulse"></div>
                            <div class="h-12 bg-slate-100 rounded animate-pulse"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Actual Content (hidden when loading) -->
    <div *ngIf="!isLoadingProfile" class="h-screen flex flex-col bg-slate-50 overflow-hidden font-sans">
        <!-- 1. FIXED HEADER (Full Width) -->
        <header class="shrink-0 bg-white border-b border-slate-200 z-30 shadow-sm relative">
            <!-- Top Bar -->
            <div
                class="px-8 py-4 flex items-center justify-between bg-gradient-to-r from-emerald-900 to-teal-900 text-white">
                <div class="flex items-center gap-4">
                    <div class="relative group" [ngClass]="{'cursor-pointer': isEditing}"
                        (click)="isEditing && fileInput.click()">
                        <input type="file" #fileInput hidden (change)="onFileSelected($event)" accept="image/*">
                        <div
                            class="h-16 w-16 rounded-xl bg-white/10 backdrop-blur-md flex items-center justify-center text-xl font-bold border border-white/20 shadow-inner overflow-hidden relative">
                            <img *ngIf="imagePreview || user?.profile_image"
                                [src]="imagePreview || 'http://localhost:3000/' + user.profile_image"
                                class="w-full h-full object-cover rounded-xl">
                            <span *ngIf="!imagePreview && !user?.profile_image">{{ user?.name?.charAt(0) || 'U'
                                }}</span>

                            <!-- Hover Overlay -->
                            <div *ngIf="isEditing"
                                class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="fas fa-camera text-white/80"></i>
                            </div>
                        </div>
                        <div
                            class="absolute -bottom-1 -right-1 h-4 w-4 bg-emerald-400 border-2 border-emerald-900 rounded-full">
                        </div>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight">{{ user?.name || 'User Profile' }}</h1>
                        <p class="text-emerald-200 text-xs font-medium uppercase tracking-wider">{{ isDoctor ?
                            (profileForm.get('title')?.value || 'Medical Professional') : 'HealthConnect Member' }}</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <div class="hidden md:flex flex-col items-end mr-4">
                        <div class="flex items-center gap-2 text-xs font-medium text-emerald-100/80 mb-1">
                            <span>Profile Completion</span>
                            <span class="text-white">{{ profileCompletion }}%</span>
                        </div>
                        <div class="w-32 h-1.5 bg-black/20 rounded-full overflow-hidden">
                            <div class="h-full bg-emerald-400 rounded-full shadow-[0_0_10px_rgba(52,211,153,0.5)] transition-all duration-1000"
                                [style.width.%]="profileCompletion"></div>
                        </div>
                    </div>

                    <button (click)="downloadData()"
                        class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white text-sm font-medium rounded-lg transition-all border border-white/10 flex items-center gap-2">
                        <i class="fas fa-download"></i> <span class="hidden sm:inline">Data</span>
                    </button>
                    <button (click)="toggleEdit()"
                        class="px-6 py-2 text-sm font-bold rounded-lg transition-all shadow-lg flex items-center gap-2"
                        [ngClass]="isEditing ? 'bg-white text-emerald-900 hover:bg-emerald-50' : 'bg-emerald-500 text-white hover:bg-emerald-400 shadow-emerald-500/20'">
                        <i class="fas" [ngClass]="isEditing ? 'fa-times' : 'fa-pen'"></i>
                        {{ isEditing ? 'Cancel' : 'Edit' }}
                    </button>
                </div>
            </div>

            <!-- Navigation Tabs (Integrated in Header) -->
            <div class="px-8 flex gap-8 bg-white">
                <button (click)="switchTab('profile')"
                    class="py-4 text-sm font-bold border-b-2 transition-all flex items-center gap-2"
                    [ngClass]="activeTab === 'profile' ? 'border-emerald-600 text-emerald-700' : 'border-transparent text-slate-500 hover:text-slate-800'">
                    <i class="fas fa-user-circle"
                        [ngClass]="activeTab === 'profile' ? 'text-emerald-500' : 'text-slate-400'"></i> Profile Details
                </button>
                <button (click)="switchTab('activity')"
                    class="py-4 text-sm font-bold border-b-2 transition-all flex items-center gap-2"
                    [ngClass]="activeTab === 'activity' ? 'border-emerald-600 text-emerald-700' : 'border-transparent text-slate-500 hover:text-slate-800'">
                    <i class="fas fa-history"
                        [ngClass]="activeTab === 'activity' ? 'text-emerald-500' : 'text-slate-400'"></i> Activity Log
                </button>
                <button (click)="switchTab('security')"
                    class="py-4 text-sm font-bold border-b-2 transition-all flex items-center gap-2"
                    [ngClass]="activeTab === 'security' ? 'border-emerald-600 text-emerald-700' : 'border-transparent text-slate-500 hover:text-slate-800'">
                    <i class="fas fa-shield-alt"
                        [ngClass]="activeTab === 'security' ? 'text-emerald-500' : 'text-slate-400'"></i> Security
                </button>

                <!-- Save Button -->
                <div class="ml-auto flex items-center" *ngIf="isEditing">
                    <button (click)="saveProfile()" [disabled]="!profileForm.valid || isLoading"
                        class="px-6 py-2 bg-slate-900 text-white text-sm rounded-lg font-bold shadow-lg hover:bg-slate-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                        <i *ngIf="!isLoading" class="fas fa-check-circle text-emerald-400"></i>
                        <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
                        <span>{{ isLoading ? 'Saving...' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- 2. MAIN LAYOUT (Fixed Sidebar + Scrollable Content) -->
        <div class="flex-1 flex overflow-hidden">

            <!-- LEFT SIDEBAR (Fixed) -->
            <aside class="w-80 bg-slate-50 border-r border-slate-200 overflow-y-auto hidden lg:block z-10">
                <div class="p-6 space-y-6">
                    <!-- Stats Widget -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Quick Stats</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between group">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="h-8 w-8 rounded-lg bg-emerald-50 text-emerald-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <span class="text-sm font-medium text-slate-600">Member Since</span>
                                </div>
                                <span class="text-sm font-bold text-slate-800">{{ getMemberSince() }}</span>
                            </div>
                            <div class="flex items-center justify-between group">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="h-8 w-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <span class="text-sm font-medium text-slate-600">Verified Email</span>
                                </div>
                                <i class="fas fa-check-circle text-emerald-500"></i>
                            </div>
                            <div *ngIf="isDoctor" class="flex items-center justify-between group">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="h-8 w-8 rounded-lg bg-amber-50 text-amber-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <span class="text-sm font-medium text-slate-600">Rating</span>
                                </div>
                                <span class="text-sm font-bold text-slate-800">{{ stats.rating | number:'1.1-1'
                                    }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="space-y-2">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-1">Account Actions
                        </h3>
                        <button (click)="changePassword()"
                            class="w-full p-3 bg-white hover:bg-slate-50 border border-slate-200 hover:border-slate-300 rounded-xl text-left flex items-center gap-3 transition-all group shadow-sm hover:shadow">
                            <div
                                class="h-8 w-8 rounded-lg bg-slate-100 text-slate-600 flex items-center justify-center group-hover:bg-slate-200 transition-colors">
                                <i class="fas fa-key text-xs"></i>
                            </div>
                            <span class="text-sm font-semibold text-slate-700">Change Password</span>
                        </button>
                        <button (click)="enable2FA()"
                            class="w-full p-3 bg-white hover:bg-slate-50 border border-slate-200 hover:border-slate-300 rounded-xl text-left flex items-center gap-3 transition-all group shadow-sm hover:shadow">
                            <div
                                class="h-8 w-8 rounded-lg bg-slate-100 text-slate-600 flex items-center justify-center group-hover:bg-slate-200 transition-colors">
                                <i class="fas fa-shield-alt text-xs"></i>
                            </div>
                            <span class="text-sm font-semibold text-slate-700">Enable 2FA</span>
                        </button>
                        <button (click)="deleteAccount()"
                            class="w-full p-3 bg-white hover:bg-red-50 border border-slate-200 hover:border-red-200 rounded-xl text-left flex items-center gap-3 transition-all group shadow-sm hover:shadow">
                            <div
                                class="h-8 w-8 rounded-lg bg-red-50 text-red-500 flex items-center justify-center group-hover:bg-red-100 transition-colors">
                                <i class="fas fa-trash text-xs"></i>
                            </div>
                            <span class="text-sm font-semibold text-red-600">Delete Account</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- RIGHT CONTENT (Scrollable) -->
            <main class="flex-1 overflow-y-auto bg-slate-50/50 p-6 lg:p-10 scroll-smooth">
                <div class="w-full mx-auto">

                    <!-- PROFILE TAB -->
                    <div *ngIf="activeTab === 'profile'" class="animate-fade-in space-y-8">
                        <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">

                            <!-- Section: Personal Info -->
                            <section
                                class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                                <div
                                    class="px-8 py-6 border-b border-slate-100 flex items-center gap-4 bg-gradient-to-r from-slate-50 to-white">
                                    <div
                                        class="h-12 w-12 rounded-xl bg-emerald-100 text-emerald-600 flex items-center justify-center text-xl shadow-sm">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-slate-800">Personal Information</h3>
                                        <p class="text-sm text-slate-500">Basic identification details</p>
                                    </div>
                                </div>
                                <div class="p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <div class="form-group">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Full
                                            Name</label>
                                        <input type="text" formControlName="name" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="form-group">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Email
                                            Address</label>
                                        <input type="email" formControlName="email" readonly
                                            class="w-full px-4 py-3 bg-slate-100 border border-transparent rounded-xl text-slate-400 font-medium cursor-not-allowed">
                                    </div>
                                    <div class="form-group">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Phone
                                            Number</label>
                                        <input type="tel" formControlName="phone" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="form-group">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Date
                                            of Birth</label>
                                        <input type="date" formControlName="dob" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="form-group">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Gender</label>
                                        <select formControlName="gender" [attr.disabled]="!isEditing ? '' : null"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none appearance-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                            <option value="">Select Gender</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Blood
                                            Group</label>
                                        <select formControlName="blood_group" [attr.disabled]="!isEditing ? '' : null"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none appearance-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                            <option value="">Select Type</option>
                                            <option value="A+">A+</option>
                                            <option value="A-">A-</option>
                                            <option value="B+">B+</option>
                                            <option value="B-">B-</option>
                                            <option value="O+">O+</option>
                                            <option value="O-">O-</option>
                                            <option value="AB+">AB+</option>
                                            <option value="AB-">AB-</option>
                                        </select>
                                    </div>
                                    <div class="col-span-1 md:col-span-2 lg:col-span-3">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Full
                                            Address</label>
                                        <input type="text" formControlName="address" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}"
                                            placeholder="Street, City, State, Zip Code">
                                    </div>
                                </div>
                            </section>

                            <!-- Section: Medical / Professional -->
                            <section *ngIf="!isDoctor"
                                class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                                <div
                                    class="px-8 py-6 border-b border-slate-100 flex items-center gap-4 bg-gradient-to-r from-slate-50 to-white">
                                    <div
                                        class="h-12 w-12 rounded-xl bg-rose-100 text-rose-600 flex items-center justify-center text-xl shadow-sm">
                                        <i class="fas fa-heartbeat"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-slate-800">Health Profile</h3>
                                        <p class="text-sm text-slate-500">Medical metrics and emergency details</p>
                                    </div>
                                </div>
                                <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Height
                                            (cm)</label>
                                        <input type="number" formControlName="height" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Weight
                                            (kg)</label>
                                        <input type="number" formControlName="weight" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Known
                                            Allergies</label>
                                        <textarea formControlName="allergies" [readonly]="!isEditing" rows="2"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none resize-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}"
                                            placeholder="List any allergies..."></textarea>
                                    </div>
                                    <div class="md:col-span-2 border-t border-slate-100 pt-6 mt-2">
                                        <h4 class="text-sm font-bold text-slate-800 mb-4 flex items-center gap-2"><i
                                                class="fas fa-phone-alt text-slate-400"></i> Emergency Contact</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <label
                                                    class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Contact
                                                    Name</label>
                                                <input type="text" formControlName="emergency_contact_name"
                                                    [readonly]="!isEditing"
                                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                                    [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                            </div>
                                            <div>
                                                <label
                                                    class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Contact
                                                    Phone</label>
                                                <input type="tel" formControlName="emergency_contact_phone"
                                                    [readonly]="!isEditing"
                                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                                    [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section *ngIf="isDoctor"
                                class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                                <div
                                    class="px-8 py-6 border-b border-slate-100 flex items-center gap-4 bg-gradient-to-r from-slate-50 to-white">
                                    <div
                                        class="h-12 w-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center text-xl shadow-sm">
                                        <i class="fas fa-user-md"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-slate-800">Professional Profile</h3>
                                        <p class="text-sm text-slate-500">Credentials and clinic information</p>
                                    </div>
                                </div>
                                <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Professional
                                            Title</label>
                                        <input type="text" formControlName="title" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Registration
                                            Number</label>
                                        <input type="text" formControlName="registration_number" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Specialization</label>
                                        <select formControlName="specialization"
                                            [attr.disabled]="!isEditing ? '' : null"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                            <option value="">Select</option>
                                            <option value="Ayurveda">Ayurveda</option>
                                            <option value="Cardiology">Cardiology</option>
                                            <option value="Dermatology">Dermatology</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Experience
                                            (Years)</label>
                                        <input type="number" formControlName="experience" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Qualifications</label>
                                        <input type="text" formControlName="qualifications" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">About
                                            / Bio</label>
                                        <textarea formControlName="about" [readonly]="!isEditing" rows="3"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none resize-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}"></textarea>
                                    </div>
                                </div>
                            </section>

                            <section *ngIf="isDoctor"
                                class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                                <div
                                    class="px-8 py-6 border-b border-slate-100 flex items-center gap-4 bg-gradient-to-r from-slate-50 to-white">
                                    <div
                                        class="h-12 w-12 rounded-xl bg-teal-100 text-teal-600 flex items-center justify-center text-xl shadow-sm">
                                        <i class="fas fa-clinic-medical"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-slate-800">Clinic Details</h3>
                                        <p class="text-sm text-slate-500">Location and availability</p>
                                    </div>
                                </div>
                                <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="md:col-span-2">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Clinic
                                            Name</label>
                                        <input type="text" formControlName="clinic_name" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Clinic
                                            Address</label>
                                        <input type="text" formControlName="clinic_address" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Timings</label>
                                        <input type="text" formControlName="clinic_timings" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Consultation
                                            Fee (â‚¹)</label>
                                        <input type="number" formControlName="consultationFee" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">Website</label>
                                        <input type="url" formControlName="website" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-slate-900 uppercase tracking-wider mb-2 block">LinkedIn</label>
                                        <input type="url" formControlName="linkedin" [readonly]="!isEditing"
                                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all outline-none"
                                            [ngClass]="{'bg-white border-emerald-200 shadow-sm': isEditing}">
                                    </div>
                                </div>
                            </section>

                            <!-- Save button moved to header -->

                        </form>
                    </div>

                    <!-- ACTIVITY TAB -->
                    <div *ngIf="activeTab === 'activity'" class="animate-fade-in max-w-3xl mx-auto">
                        <div class="relative border-l-2 border-slate-200 ml-4 space-y-8 py-4">
                            <div *ngFor="let activity of activities" class="relative pl-8 group">
                                <!-- Dot -->
                                <div class="absolute -left-[9px] top-4 h-4 w-4 rounded-full border-2 border-white shadow-sm transition-all group-hover:scale-125"
                                    [ngClass]="{
                                    'bg-emerald-500': activity.type === 'appointment',
                                    'bg-blue-500': activity.type === 'profile_update',
                                    'bg-purple-500': activity.type === 'account'
                                }">
                                </div>

                                <!-- Card -->
                                <div
                                    class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-all">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-bold text-slate-800 text-lg">{{ activity.title }}</h4>
                                        <span
                                            class="text-xs font-bold text-slate-500 bg-slate-100 px-3 py-1 rounded-full">{{
                                            formatDate(activity.date) }}</span>
                                    </div>
                                    <p class="text-slate-600">{{ activity.description }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECURITY TAB -->
                    <div *ngIf="activeTab === 'security'" class="animate-fade-in max-w-3xl mx-auto space-y-4">
                        <div
                            class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 flex items-center justify-between group hover:border-emerald-200 transition-colors">
                            <div class="flex items-center gap-6">
                                <div
                                    class="h-16 w-16 rounded-2xl bg-amber-50 text-amber-500 flex items-center justify-center text-2xl">
                                    <i class="fas fa-key"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 text-lg">Change Password</h4>
                                    <p class="text-slate-500">Update your password regularly to keep your account
                                        secure.
                                    </p>
                                </div>
                            </div>
                            <button (click)="changePassword()"
                                class="px-6 py-3 bg-white border border-slate-200 rounded-xl text-slate-700 font-bold hover:bg-slate-50 hover:border-slate-300 transition-all shadow-sm">
                                Update
                            </button>
                        </div>

                        <div
                            class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 flex items-center justify-between group hover:border-emerald-200 transition-colors">
                            <div class="flex items-center gap-6">
                                <div
                                    class="h-16 w-16 rounded-2xl bg-emerald-50 text-emerald-500 flex items-center justify-center text-2xl">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 text-lg">Two-Factor Authentication</h4>
                                    <p class="text-slate-500">Add an extra layer of security to your account.</p>
                                </div>
                            </div>
                            <button (click)="enable2FA()"
                                class="px-6 py-3 bg-white border border-slate-200 rounded-xl text-slate-700 font-bold hover:bg-slate-50 hover:border-slate-300 transition-all shadow-sm">
                                Enable
                            </button>
                        </div>

                        <div
                            class="bg-red-50 p-8 rounded-2xl border border-red-100 flex items-center justify-between mt-8">
                            <div class="flex items-center gap-6">
                                <div
                                    class="h-16 w-16 rounded-2xl bg-red-100 text-red-500 flex items-center justify-center text-2xl">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-red-800 text-lg">Delete Account</h4>
                                    <p class="text-red-600">Permanently remove your account and all data.</p>
                                </div>
                            </div>
                            <button (click)="deleteAccount()"
                                class="px-6 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-all shadow-lg shadow-red-200">
                                Delete
                            </button>
                        </div>
                    </div>

                </div>
            </main>
        </div>

        <!-- Modals (Kept same logic, updated styling) -->
        <div *ngIf="showPasswordModal"
            class="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in-up p-8">
                <h3 class="text-2xl font-bold text-slate-900 mb-6">Change Password</h3>
                <input type="password" [(ngModel)]="newPassword"
                    class="w-full px-4 py-3 border border-slate-200 rounded-xl mb-6 focus:border-emerald-500 outline-none"
                    placeholder="New Password">
                <div class="flex justify-end gap-3">
                    <button (click)="showPasswordModal = false"
                        class="px-6 py-2.5 text-slate-500 font-bold hover:bg-slate-50 rounded-lg transition-colors">Cancel</button>
                    <button (click)="confirmChangePassword()"
                        class="px-8 py-2.5 bg-slate-900 text-white rounded-lg font-bold hover:bg-slate-800 transition-colors">Update
                        Password</button>
                </div>
            </div>
        </div>

        <div *ngIf="show2FAModal"
            class="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
            <div
                class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in-up p-8 text-center">
                <div
                    class="h-20 w-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6 text-emerald-600 text-3xl">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3 class="text-2xl font-bold text-slate-900 mb-2">Enable 2FA?</h3>
                <p class="text-slate-500 mb-8">This will add an extra layer of security to your account.</p>
                <div class="flex justify-center gap-4">
                    <button (click)="show2FAModal = false"
                        class="px-6 py-2.5 text-slate-500 font-bold hover:bg-slate-50 rounded-lg transition-colors">Cancel</button>
                    <button (click)="confirmEnable2FA()"
                        class="px-8 py-2.5 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors">Enable</button>
                </div>
            </div>
        </div>

        <div *ngIf="showDeleteModal"
            class="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
            <div
                class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in-up p-8 text-center">
                <div
                    class="h-20 w-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 text-red-600 text-3xl">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="text-2xl font-bold text-slate-900 mb-2">Delete Account?</h3>
                <p class="text-slate-500 mb-8">This action cannot be undone. Are you sure?</p>
                <div class="flex justify-center gap-4">
                    <button (click)="showDeleteModal = false"
                        class="px-6 py-2.5 text-slate-500 font-bold hover:bg-slate-50 rounded-lg transition-colors">Cancel</button>
                    <button (click)="confirmDeleteAccount()"
                        class="px-8 py-2.5 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors">Delete
                        Permanently</button>
                </div>
            </div>
        </div>

    </div>
</div>