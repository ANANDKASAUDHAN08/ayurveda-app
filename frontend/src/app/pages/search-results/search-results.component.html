<!-- Full Width Container -->
<div class="min-h-screen bg-gray-50">
    <!-- Top Bar with Search Info & View Toggle -->
    <div
        class="bg-white backdrop-blur-xl backdrop-saturate-[1.8] border-b border-gray-300/30 sticky top-16 md:top-18 z-40">
        <div class="max-w-[1920px] mx-auto px-4 lg:px-8 py-3 lg:py-4">
            <!-- Primary Row: Query & Controls -->
            <div class="flex flex-col lg:flex-row items-center justify-between gap-5 lg:gap-3">
                <!-- Search Query & Results Count (Centered on Mobile) -->
                <div
                    class="flex flex-col lg:flex-row items-center lg:items-baseline gap-2.5 lg:gap-4 text-center lg:text-left w-full lg:w-auto">
                    <div class="flex items-center justify-center lg:justify-start gap-2.5">
                        <h1 class="text-xl md:text-2xl font-black text-gray-900 tracking-tight leading-none">
                            {{ filters.q ? '"' + filters.q + '"' : 'All Health Products' }}
                        </h1>
                        <!-- Clear Search Query Button -->
                        <button *ngIf="filters.q" (click)="removeFilter('q')"
                            class="w-6 h-6 flex items-center justify-center rounded-full bg-gray-100 text-gray-400 hover:bg-rose-50 hover:text-rose-500 transition-all active:scale-95 shadow-sm border border-gray-200/50 shrink-0"
                            title="Clear search">
                            <i class="fas fa-times text-[10px]"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-center lg:justify-start gap-2">
                        <span
                            class="text-xs font-bold text-emerald-600 uppercase tracking-tight bg-emerald-50 px-2 py-0.5 rounded-md leading-none">
                            Results
                        </span>
                        <div class="h-1 w-1 bg-gray-300 rounded-full shrink-0"></div>
                        <span class="text-sm font-medium text-gray-500 whitespace-nowrap" *ngIf="!loading">
                            {{ pagination.total }} items found
                        </span>
                        <div class="h-1 w-1 bg-gray-300 rounded-full shrink-0" *ngIf="!loading"></div>
                        <app-share-button *ngIf="!loading" [shareData]="getShareData()"
                            customClass="text-gray-400 hover:text-emerald-600 transition-colors p-1"
                            title="Share Search Result">
                        </app-share-button>
                    </div>
                </div>

                <!-- View Toggle & Sort & Filter (Mobile Row) -->
                <div
                    class="flex items-center justify-between lg:justify-end gap-2 sm:gap-3 w-full lg:w-auto shrink-0 border-t border-gray-100 lg:border-none pt-4 lg:pt-0">
                    <!-- View Toggle (Sliding Pill) -->
                    <div class="relative bg-gray-100/80 p-1 rounded-xl flex border border-gray-200/50 shrink-0">
                        <!-- Sliding Indicator -->
                        <div class="absolute top-1 bottom-1 left-1 bg-white rounded-lg shadow-sm transition-all duration-300 ease-out z-0"
                            [style.width]="'calc(50% - 4px)'"
                            [style.transform]="viewMode === 'list' ? 'translateX(100%)' : 'translateX(0)'">
                        </div>

                        <button (click)="viewMode = 'grid'"
                            class="relative z-10 px-3 sm:px-4 py-1.5 rounded-lg transition-colors duration-300 flex items-center gap-1.5 text-xs sm:text-sm font-bold"
                            [class.text-emerald-600]="viewMode === 'grid'" [class.text-gray-500]="viewMode !== 'grid'">
                            <i class="fas fa-th-large text-[10px] sm:text-xs"></i>
                            <span class="hidden sm:inline">Grid</span>
                        </button>
                        <button (click)="viewMode = 'list'"
                            class="relative z-10 px-3 sm:px-4 py-1.5 rounded-lg transition-colors duration-300 flex items-center gap-1.5 text-xs sm:text-sm font-bold"
                            [class.text-emerald-600]="viewMode === 'list'" [class.text-gray-500]="viewMode !== 'list'">
                            <i class="fas fa-list-ul text-[10px] sm:text-xs"></i>
                            <span class="hidden sm:inline">List</span>
                        </button>
                    </div>

                    <!-- Sort Dropdown (Custom Styled) -->
                    <div class="relative flex-1 lg:flex-none">
                        <button (click)="toggleDropdown('sort', $event)"
                            class="w-full flex items-center gap-2 bg-white border border-gray-200 px-3 sm:px-4 py-2 rounded-xl text-xs sm:text-sm font-bold text-gray-800 hover:border-emerald-500 transition-all shadow-sm focus:ring-4 focus:ring-emerald-500/10 lg:min-w-[180px] justify-between group">
                            <span class="flex items-center gap-2 truncate">
                                <i
                                    class="fas fa-sort-amount-down text-emerald-500 group-hover:scale-110 transition-transform"></i>
                                {{ getSelectedLabel(sortOptions, filters.sortBy) }}
                            </span>
                            <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-emerald-500 transition-transform"
                                [class.rotate-180]="activeDropdown === 'sort'"></i>
                        </button>

                        <!-- Sort Menu -->
                        <div *ngIf="activeDropdown === 'sort'" (click)="$event.stopPropagation()"
                            class="absolute right-0 mt-2 w-56 bg-white/90 backdrop-blur-xl border border-gray-200 rounded-2xl shadow-2xl shadow-emerald-900/10 overflow-hidden z-[100] animate-dropdown">
                            <div class="p-1.5">
                                <button *ngFor="let option of sortOptions"
                                    (click)="selectOption('sortBy', option.value)"
                                    class="w-full text-left px-4 py-2.5 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                    [class.bg-emerald-50]="filters.sortBy === option.value"
                                    [class.text-emerald-700]="filters.sortBy === option.value"
                                    [class.hover:bg-gray-50]="filters.sortBy !== option.value">
                                    {{ option.label }}
                                    <i *ngIf="filters.sortBy === option.value" class="fas fa-check text-[10px]"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Filter Button (Hide on Desktop) -->
                    <button (click)="toggleMobileFilters()"
                        class="lg:hidden px-4 py-2 bg-gradient-to-br from-emerald-500 to-emerald-700 text-white text-xs font-black rounded-xl shadow-lg shadow-emerald-200/50 active:scale-95 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-sliders-h text-[10px]"></i>

                        <!-- Show text only if no filters are active -->
                        <span *ngIf="activeFilterCount === 0">Filters</span>

                        <!-- Show count badge if filters are active -->
                        <span *ngIf="activeFilterCount > 0"
                            class="bg-white/20 backdrop-blur-md text-white rounded px-1.5 py-0.5 text-[9px] font-black border border-white/30">
                            {{ activeFilterCount }}
                        </span>
                    </button>
                </div>
            </div>

            <!-- Secondary Row: Active Filters (Scrollable Slim Line) -->
            <div class="flex items-center gap-3 mt-3 pt-3 border-t border-gray-100/60 min-h-[44px]"
                *ngIf="activeFilterCount > 0">
                <span
                    class="text-[10px] sm:text-xs font-black text-gray-400 uppercase tracking-widest whitespace-nowrap shrink-0">
                    Filtered by:
                </span>

                <div class="flex-1 flex items-center gap-2 overflow-x-auto custom-scrollbar-hide px-0.5">
                    <ng-container *ngFor="let filter of [
                        {key: 'type', label: filters.type, class: 'bg-emerald-50 text-emerald-700 border-emerald-100'},
                        {key: 'category', label: filters.category, class: 'bg-blue-50 text-blue-700 border-blue-100'},
                        {key: 'medicineType', label: filters.medicineType, class: 'bg-amber-50 text-amber-700 border-amber-100'},
                        {key: 'manufacturer', label: filters.manufacturer, class: 'bg-gray-50 text-gray-700 border-gray-200'},
                        {key: 'city', label: filters.city, class: 'bg-indigo-50 text-indigo-700 border-indigo-100'},
                        {key: 'rating', label: filters.minRating ? filters.minRating + '+ Stars' : null, class: 'bg-yellow-50 text-yellow-700 border-yellow-100'}
                    ]">
                        <span *ngIf="filter.label"
                            class="inline-flex items-center gap-0.5 md:gap-2 pl-3 pr-1 md:pr-3 py-1.5 rounded-xl text-xs font-bold border whitespace-nowrap bg-white shadow-sm h-8"
                            [ngClass]="filter.class">
                            {{ filter.label }}
                            <button (click)="removeFilter(filter.key)"
                                class="w-4 h-4 -mr-3 md:-mr-0 flex items-center justify-center rounded-full hover:bg-black/5 transition-colors">
                                <i class="fas fa-times text-[10px] opacity-40"></i>
                            </button>
                        </span>
                    </ng-container>

                    <span *ngIf="filters.minPrice || filters.maxPrice"
                        class="inline-flex items-center gap-0.5 md:gap-2 pl-3 pr-1 md:pr-3 py-1.5 bg-purple-50 text-purple-700 border border-purple-100 rounded-xl text-xs font-bold whitespace-nowrap shadow-sm h-8">
                        ₹{{ filters.minPrice || 0 }}-{{ filters.maxPrice || 10000 }}
                        <button (click)="removeFilter('price')"
                            class="w-4 h-4 -mr-3 md:-mr-0 flex items-center justify-center rounded-full hover:bg-black/5 transition-colors">
                            <i class="fas fa-times text-[10px] opacity-40"></i>
                        </button>
                    </span>
                </div>

                <button (click)="clearFilters()"
                    class="text-[10px] sm:text-xs font-black text-rose-500 hover:text-rose-600 px-2.5 py-1.5 rounded-lg hover:bg-rose-50 transition-all whitespace-nowrap shrink-0 uppercase tracking-tighter">
                    Reset All
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="w-full">
        <div class="flex gap-6">
            <!-- Filter Sidebar (Desktop) -->
            <aside class="hidden lg:block w-72 flex-shrink-0">
                <div
                    class="bg-white rounded-r-2xl shadow-sm border-r border-b border-gray-100 p-6 sticky top-[120px] md:top-[140px] overflow-hidden group/sidebar transition-all duration-300">
                    <!-- Sidebar Glow Effect -->
                    <div
                        class="absolute -top-24 -right-24 w-48 h-48 bg-emerald-50 rounded-full blur-3xl opacity-50 group-hover/sidebar:opacity-100 transition-opacity">
                    </div>

                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-8">
                            <h2 class="text-xl font-black text-gray-900 flex items-center gap-2">
                                <i class="fas fa-filter text-emerald-600"></i>
                                Filters
                            </h2>
                            <button (click)="clearFilters()" *ngIf="activeFilterCount > 0"
                                class="text-xs font-bold text-rose-500 hover:text-rose-600 transition-colors">
                                Clear
                            </button>
                        </div>

                        <!-- Filter Sections -->
                        <div class="space-y-8">
                            <!-- Product Type -->
                            <div class="filter-section">
                                <div class="mb-8">
                                    <label
                                        class="flex items-center gap-2 text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3">
                                        <i class="fas fa-layer-group text-emerald-500"></i>
                                        Product Type
                                    </label>
                                    <div class="relative">
                                        <button (click)="toggleDropdown('productType', $event)"
                                            class="w-full flex items-center justify-between gap-3 bg-gray-50/50 border border-gray-100 px-4 py-2.5 rounded-xl text-sm font-bold text-gray-800 hover:border-emerald-500 hover:bg-white transition-all group">
                                            <span class="truncate">{{ getSelectedLabel(productTypes, filters.type)
                                                }}</span>
                                            <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-emerald-500 transition-transform"
                                                [class.rotate-180]="activeDropdown === 'productType'"></i>
                                        </button>

                                        <div *ngIf="activeDropdown === 'productType'" (click)="$event.stopPropagation()"
                                            class="absolute left-0 right-0 mt-2 max-h-[300px] overflow-y-auto bg-white border border-gray-100 rounded-2xl shadow-xl z-50 animate-dropdown custom-scrollbar-hide">
                                            <div class="p-1.5">
                                                <button *ngFor="let type of productTypes"
                                                    (click)="selectOption('productType', type.value)"
                                                    class="w-full text-left px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                                    [class.bg-emerald-50]="filters.type === type.value"
                                                    [class.text-emerald-700]="filters.type === type.value"
                                                    [class.hover:bg-gray-50]="filters.type !== type.value">
                                                    {{ type.label }}
                                                    <i *ngIf="filters.type === type.value"
                                                        class="fas fa-check text-[10px]"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Category -->
                                <div class="mb-8" *ngIf="categories.length > 0">
                                    <label
                                        class="flex items-center gap-2 text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3">
                                        <i class="fas fa-tags text-blue-500"></i>
                                        Category
                                    </label>
                                    <div class="relative">
                                        <button (click)="toggleDropdown('category', $event)"
                                            class="w-full flex items-center justify-between gap-3 bg-gray-50/50 border border-gray-100 px-4 py-2.5 rounded-xl text-sm font-bold text-gray-800 hover:border-blue-500 hover:bg-white transition-all group">
                                            <span class="truncate">{{ filters.category || 'All Categories' }}</span>
                                            <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-blue-500 transition-transform"
                                                [class.rotate-180]="activeDropdown === 'category'"></i>
                                        </button>

                                        <div *ngIf="activeDropdown === 'category'" (click)="$event.stopPropagation()"
                                            class="absolute left-0 right-0 mt-2 max-h-[300px] overflow-y-auto bg-white border border-gray-100 rounded-2xl shadow-xl z-50 animate-dropdown custom-scrollbar-hide">
                                            <div class="p-1.5">
                                                <button (click)="selectOption('category', '')"
                                                    class="w-full text-left px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                                    [class.bg-blue-50]="!filters.category"
                                                    [class.text-blue-700]="!filters.category"
                                                    [class.hover:bg-gray-50]="filters.category">
                                                    All Categories
                                                    <i *ngIf="!filters.category" class="fas fa-check text-[10px]"></i>
                                                </button>
                                                <button *ngFor="let cat of categories"
                                                    (click)="selectOption('category', cat)"
                                                    class="w-full text-left px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                                    [class.bg-blue-50]="filters.category === cat"
                                                    [class.text-blue-700]="filters.category === cat"
                                                    [class.hover:bg-gray-50]="filters.category !== cat">
                                                    {{ cat }}
                                                    <i *ngIf="filters.category === cat"
                                                        class="fas fa-check text-[10px]"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Medicine System -->
                            <div class="filter-section">
                                <label
                                    class="flex items-center gap-2 text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3">
                                    <i class="fas fa-microscope text-emerald-500"></i>
                                    Medicine System
                                </label>
                                <div class="relative">
                                    <button (click)="toggleDropdown('medicineType', $event)"
                                        class="w-full flex items-center justify-between gap-3 bg-gray-50 border border-gray-200 px-4 py-2.5 rounded-xl text-sm font-bold text-gray-800 hover:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10 transition-all group">
                                        <span class="truncate">{{ getSelectedLabel(medicineTypes, filters.medicineType)
                                            }}</span>
                                        <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-emerald-500 transition-transform"
                                            [class.rotate-180]="activeDropdown === 'medicineType'"></i>
                                    </button>

                                    <div *ngIf="activeDropdown === 'medicineType'" (click)="$event.stopPropagation()"
                                        class="absolute left-0 right-0 mt-2 bg-white border border-gray-100 rounded-2xl shadow-xl z-50 animate-dropdown overflow-hidden">
                                        <div class="p-1.5">
                                            <button *ngFor="let mType of medicineTypes"
                                                (click)="selectOption('medicineType', mType.value)"
                                                class="w-full text-left px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                                [class.bg-emerald-50]="filters.medicineType === mType.value"
                                                [class.text-emerald-700]="filters.medicineType === mType.value"
                                                [class.hover:bg-gray-50]="filters.medicineType !== mType.value">
                                                {{ mType.label }}
                                                <i *ngIf="filters.medicineType === mType.value"
                                                    class="fas fa-check text-[10px]"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Min Rating -->
                            <div class="filter-section">
                                <label
                                    class="flex items-center gap-2 text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3">
                                    <i class="fas fa-star text-yellow-500"></i>
                                    Minimum Rating
                                </label>
                                <div class="relative">
                                    <button (click)="toggleDropdown('rating', $event)"
                                        class="w-full flex items-center justify-between gap-3 bg-gray-50 border border-gray-200 px-4 py-2.5 rounded-xl text-sm font-bold text-gray-800 hover:border-yellow-500 focus:ring-4 focus:ring-yellow-500/10 transition-all group">
                                        <span class="truncate">{{ getSelectedLabel(ratingOptions, filters.minRating ||
                                            0) }}</span>
                                        <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-yellow-500 transition-transform"
                                            [class.rotate-180]="activeDropdown === 'rating'"></i>
                                    </button>

                                    <div *ngIf="activeDropdown === 'rating'" (click)="$event.stopPropagation()"
                                        class="absolute left-0 right-0 mt-2 bg-white border border-gray-100 rounded-2xl shadow-xl z-50 animate-dropdown overflow-hidden">
                                        <div class="p-1.5">
                                            <button *ngFor="let rating of ratingOptions"
                                                (click)="selectOption('rating', rating.value)"
                                                class="w-full text-left px-4 py-2 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                                [class.bg-yellow-50]="filters.minRating === rating.value || (!filters.minRating && rating.value === 0)"
                                                [class.text-yellow-700]="filters.minRating === rating.value || (!filters.minRating && rating.value === 0)"
                                                [class.hover:bg-gray-50]="filters.minRating !== rating.value && (filters.minRating || rating.value !== 0)">
                                                {{ rating.label }}
                                                <i *ngIf="filters.minRating === rating.value || (!filters.minRating && rating.value === 0)"
                                                    class="fas fa-check text-[10px]"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Price Range -->
                            <div class="filter-section">
                                <label
                                    class="flex items-center gap-2 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-3">
                                    <i class="fas fa-wallet text-xs"></i>
                                    Price Range
                                </label>
                                <div class="grid grid-cols-2 gap-2 mb-3">
                                    <div class="relative">
                                        <span
                                            class="absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-gray-400">₹</span>
                                        <input type="number" [(ngModel)]="filters.minPrice" placeholder="Min"
                                            class="w-full pl-6 pr-2 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs font-bold focus:ring-1 focus:ring-emerald-500">
                                    </div>
                                    <div class="relative">
                                        <span
                                            class="absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-gray-400">₹</span>
                                        <input type="number" [(ngModel)]="filters.maxPrice" placeholder="Max"
                                            class="w-full pl-6 pr-2 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs font-bold focus:ring-1 focus:ring-emerald-500">
                                    </div>
                                </div>
                                <button (click)="applyFilters()"
                                    class="w-full py-2 bg-gray-900 text-white text-xs font-bold rounded-lg hover:bg-black transition-colors">
                                    Apply Price
                                </button>
                            </div>
                        </div>

                        <!-- Reset All (Bottom) -->
                        <div class="mt-8 pt-6 border-t border-gray-100" *ngIf="activeFilterCount > 0">
                            <button (click)="clearFilters()"
                                class="w-full py-3 border-2 border-rose-100 text-rose-500 text-xs font-black uppercase tracking-widest rounded-xl hover:bg-rose-50 transition-all">
                                Reset All Filters
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Results Section -->
            <div class="flex-1 flex flex-col min-w-0" style="height: calc(100vh - 10px);">
                <main class="flex-1 overflow-y-auto pr-0 custom-scrollbar-hide pb-8 pr-3 pl-3 md:pr-5 md:pl-0">
                    <!-- Loading State (Enhanced Shimmer) -->
                    <div *ngIf="loading" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                        <div *ngFor="let i of Array(skeletonCount).fill(0)"
                            class="rounded-3xl overflow-hidden bg-white border border-gray-100 p-4 animate-pulse">
                            <div class="animate-shimmer h-40 rounded-2xl mb-4"></div>
                            <div class="animate-shimmer h-4 bg-gray-200 rounded-lg mb-2 w-3/4"></div>
                            <div class="animate-shimmer h-3 bg-gray-200 rounded-lg mb-4 w-1/2"></div>
                            <div class="flex gap-2">
                                <div class="animate-shimmer h-10 bg-gray-200 rounded-xl flex-1"></div>
                                <div class="animate-shimmer h-10 bg-gray-200 rounded-xl flex-1"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Grid -->
                    <div *ngIf="!loading && hasResults">
                        <!-- Grid View with Category Grouping (Redesigned) -->
                        <div *ngIf="viewMode === 'grid'" class="space-y-8">
                            <div *ngFor="let type of getOrderedGroupKeys()" class="relative">
                                <!-- Category Header Modern (Dynamic Colors) -->
                                <div class="group-header-modern" [ngClass]="'theme-' + getTypeColor(type)">
                                    <div class="type-icon-wrapper">
                                        <i [class]="'fas ' + getTypeIcon(type) + ' text-xl'"></i>
                                    </div>
                                    <div class="flex-1 pt-0.5 md:pt-1">
                                        <div class="flex items-center gap-4">
                                            <h2 class="text-xl md:text-2xl font-black text-gray-900 tracking-tight">
                                                {{ getTypeLabel(type) }}
                                            </h2>
                                            <div class="type-divider flex-1"></div>
                                        </div>
                                        <span
                                            class="text-[10px] font-black text-gray-400 uppercase tracking-widest block mt-1 hover:text-gray-600 transition-colors">
                                            Showing {{ Math.min(getDisplayLimit(), groupedResults[type].length) }}
                                            of {{ groupedResults[type].length }} items in this gallery
                                        </span>
                                    </div>
                                </div>

                                <!-- Specialized Grids by Type -->
                                <div [ngSwitch]="type">
                                    <!-- Herb Grid (2 Col Mobile) -->
                                    <div *ngSwitchCase="'herb'"
                                        class="grid grid-cols-2 gap-2.5 md:gap-4 lg:gap-6 md:grid-cols-4">
                                        <app-herb-card
                                            *ngFor="let product of groupedResults[type].slice(0, getDisplayLimit())"
                                            [herb]="product" (herbClick)="openHerbDetails($event)">
                                        </app-herb-card>
                                    </div>

                                    <!-- Hospital Grid (Custom responsive cols) -->
                                    <div *ngSwitchCase="'hospital'"
                                        class="grid grid-cols-1 gap-2.5 md:gap-4 lg:gap-6 md:grid-cols-2 lg:grid-cols-3">
                                        <app-hospital-card
                                            *ngFor="let product of groupedResults[type].slice(0, getDisplayLimit())"
                                            [hospital]="product" [isFavorite]="isFavorite(product.id)"
                                            (toggleFavorite)="toggleFavorite($event, product)"
                                            (viewDetails)="viewDetails(product)" class="h-full">
                                        </app-hospital-card>
                                    </div>

                                    <!-- Doctor Grid -->
                                    <div *ngSwitchCase="'doctor'"
                                        class="grid grid-cols-1 gap-2.5 md:gap-4 lg:gap-6 md:grid-cols-3">
                                        <app-doctor-card
                                            *ngFor="let product of groupedResults[type].slice(0, getDisplayLimit())"
                                            [doctor]="product" [viewMode]="'grid'"
                                            [isOnline]="isDoctorOnline(product.id)" [isFree]="isFirstTimeUser"
                                            (book)="bookAppointment($event)" (viewDetails)="openDoctorDetails($event)"
                                            (instantConsult)="onInstantConsult($event)">
                                        </app-doctor-card>
                                    </div>

                                    <!-- Ayurveda Medicine Grid -->
                                    <div *ngSwitchCase="'ayurveda_medicine'"
                                        class="grid grid-cols-2 gap-2.5 md:gap-4 lg:gap-6 md:grid-cols-3">
                                        <app-ayurveda-medicine-card
                                            *ngFor="let product of groupedResults[type].slice(0, getDisplayLimit())"
                                            [medicine]="product" [viewMode]="'grid'"
                                            (viewDetails)="openAyurvedaMedicineDetails($event)">
                                        </app-ayurveda-medicine-card>
                                    </div>

                                    <!-- Medicine/Product Grid -->
                                    <div *ngSwitchDefault
                                        class="grid grid-cols-2 gap-2.5 md:gap-4 lg:gap-6 md:grid-cols-3">
                                        <app-medicine-card
                                            *ngFor="let product of groupedResults[type].slice(0, getDisplayLimit())"
                                            [product]="product"
                                            [isAddingToCart]="!!addingToCart[product.product_type + '-' + product.id]"
                                            [viewMode]="viewMode" [highlightText]="filters.q || ''"
                                            (viewDetails)="viewDetails($event)">
                                        </app-medicine-card>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- List View with Category Grouping -->
                        <div *ngIf="viewMode === 'list'" class="space-y-8">
                            <!-- Loop through each product type -->
                            <div *ngFor="let type of getOrderedGroupKeys()">
                                <!-- Category Header with Divider (Dynamic Colors) -->
                                <div class="group-header-modern" [ngClass]="'theme-' + getTypeColor(type)">
                                    <div class="type-icon-wrapper">
                                        <i [class]="'fas ' + getTypeIcon(type) + ' text-xl'"></i>
                                    </div>
                                    <div class="flex-1 pt-0.5 md:pt-1">
                                        <div class="flex items-center gap-4">
                                            <h2 class="text-xl md:text-2xl font-black text-gray-900 tracking-tight">
                                                {{ getTypeLabel(type) }}
                                            </h2>
                                            <div class="type-divider flex-1"></div>
                                        </div>
                                        <span
                                            class="text-[10px] font-black text-gray-400 uppercase tracking-widest block mt-1 hover:text-gray-600 transition-colors">
                                            Showing {{ Math.min(getDisplayLimit(), groupedResults[type].length) }}
                                            of {{ groupedResults[type].length }} items in this gallery
                                        </span>
                                    </div>
                                </div>

                                <!-- List for this category -->
                                <div class="space-y-4">
                                    <ng-container
                                        *ngFor="let product of groupedResults[type].slice(0, getDisplayLimit())">

                                        <!-- Hospital card: use shared component -->
                                        <div *ngIf="product.product_type === 'hospital'" class="mb-2">
                                            <app-hospital-card [hospital]="product"
                                                [isFavorite]="isFavorite(product.id)"
                                                (viewDetails)="openHospitalDetails(product)"
                                                (toggleFavorite)="toggleFavorite($event, product)">
                                            </app-hospital-card>
                                        </div>

                                        <!-- Doctor card: use shared component -->
                                        <app-doctor-card *ngIf="product.product_type === 'doctor'" [doctor]="product"
                                            [viewMode]="'list'" [isOnline]="isDoctorOnline(product.id)"
                                            [isFree]="isFirstTimeUser" (book)="bookAppointment($event)"
                                            (viewDetails)="openDoctorDetails($event)"
                                            (instantConsult)="onInstantConsult($event)">
                                        </app-doctor-card>

                                        <!-- Herb card: use specialized component -->
                                        <div class="gap-2">
                                            <app-herb-card *ngIf="product.product_type === 'herb'" [herb]="product"
                                                (herbClick)="openHerbDetails($event)">
                                            </app-herb-card>
                                        </div>

                                        <!-- Ayurveda Medicine card -->
                                        <app-ayurveda-medicine-card *ngIf="product.product_type === 'ayurveda_medicine'"
                                            [medicine]="product" [viewMode]="'list'"
                                            (viewDetails)="openAyurvedaMedicineDetails($event)">
                                        </app-ayurveda-medicine-card>

                                        <!-- Medicine/Product card -->
                                        <app-medicine-card
                                            *ngIf="product.product_type !== 'hospital' && product.product_type !== 'doctor' && product.product_type !== 'herb' && product.product_type !== 'ayurveda_medicine'"
                                            [product]="product"
                                            [isAddingToCart]="!!addingToCart[product.product_type + '-' + product.id]"
                                            [viewMode]="'list'" [highlightText]="filters.q || ''"
                                            (viewDetails)="viewDetails($event)">
                                        </app-medicine-card>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State (Redesigned for Mobile & 2-Column Desktop) -->
                    <div *ngIf="!loading && !hasResults" class="py-5 lg:py-10 px-4">
                        <div class="max-w-6xl mx-auto flex flex-col lg:flex-row gap-12 lg:gap-16 items-start">

                            <!-- Left: Status & Primary Actions -->
                            <div class="w-full lg:w-[35%] text-center lg:text-left lg:sticky lg:top-20">
                                <!-- <div
                                    class="w-20 h-20 bg-gray-100 rounded-[24px] flex items-center justify-center mx-auto lg:mx-0 mb-8 border border-gray-200/50 shadow-sm animate-pulse">
                                    <i class="fas fa-search text-3xl text-gray-300"></i>
                                </div> -->
                                <h3
                                    class="text-3xl lg:text-4xl font-black text-gray-900 mb-4 tracking-tight leading-[1.1]">
                                    No results for <br class="hidden lg:block">
                                    <span class="text-emerald-600">"{{ filters.q }}"</span>
                                </h3>
                                <p class="text-gray-500 mb-10 text-base sm:text-lg font-medium leading-relaxed">
                                    We couldn't find a match. Try adjusting your filters or use more general terms.
                                </p>

                                <div class="flex flex-col gap-3">
                                    <button (click)="clearFilters()"
                                        class="w-full py-4 bg-emerald-600 text-white font-black rounded-2xl hover:bg-emerald-700 transition-all shadow-xl shadow-emerald-200/50 uppercase text-[11px] tracking-[0.15em] flex items-center justify-center gap-2 active:scale-[0.98]">
                                        <i class="fas fa-filter-circle-xmark"></i>
                                        Clear All Filters
                                    </button>
                                    <a routerLink="/"
                                        class="w-full py-4 bg-gray-100 text-gray-700 font-black rounded-2xl hover:bg-gray-200 transition-all text-center uppercase text-[11px] tracking-[0.15em] active:scale-[0.98]">
                                        Back to Home
                                    </a>
                                </div>
                            </div>

                            <!-- Right: Tips & Category Explorer -->
                            <div class="w-full lg:w-[65%] space-y-10">
                                <!-- Tip Cards Grid -->
                                <div class="grid sm:grid-cols-2 gap-4">
                                    <!-- Search Tips -->
                                    <div
                                        class="bg-white p-6 rounded-[28px] border border-gray-100 shadow-sm hover:shadow-md transition-all group">
                                        <div
                                            class="w-10 h-10 bg-amber-50 rounded-xl flex items-center justify-center mb-5 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-lightbulb text-amber-500"></i>
                                        </div>
                                        <h4 class="font-black text-gray-900 mb-4 text-xs uppercase tracking-widest">
                                            Search Tips</h4>
                                        <ul class="space-y-4 text-[13px] text-gray-500 font-semibold">
                                            <li class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-emerald-500/40 mt-0.5"></i>
                                                Check for typos or spelling errors
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-emerald-500/40 mt-0.5"></i>
                                                Use more general keywords
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-emerald-500/40 mt-0.5"></i>
                                                Try searching for symptoms
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Filter Tips -->
                                    <div
                                        class="bg-white p-6 rounded-[28px] border border-gray-100 shadow-sm hover:shadow-md transition-all group">
                                        <div
                                            class="w-10 h-10 bg-blue-50 rounded-xl flex items-center justify-center mb-5 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-filter text-blue-500"></i>
                                        </div>
                                        <h4 class="font-black text-gray-900 mb-4 text-xs uppercase tracking-widest">
                                            Filter Tips</h4>
                                        <ul class="space-y-4 text-[13px] text-gray-500 font-semibold">
                                            <li class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-blue-500/40 mt-0.5"></i>
                                                Broaden your price range
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-blue-500/40 mt-0.5"></i>
                                                Switch to "All Results" in Type
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-blue-500/40 mt-0.5"></i>
                                                Reset filters to see everything
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Popular Categories Grid (More Compact for Mobile) -->
                                <div class="bg-gray-50/50 p-6 lg:p-10 rounded-[40px] border border-gray-100/50">
                                    <h4
                                        class="text-[10px] font-black text-gray-400 uppercase tracking-[0.25em] mb-8 text-center lg:text-left">
                                        OR EXPLORE POPULAR CATEGORIES
                                    </h4>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <a routerLink="/medicines"
                                            class="p-5 bg-white rounded-3xl border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all group">
                                            <div
                                                class="w-12 h-12 bg-emerald-50 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-emerald-600 transition-colors">
                                                <i
                                                    class="fas fa-pills text-emerald-600 text-xl group-hover:text-white"></i>
                                            </div>
                                            <span
                                                class="block text-center text-xs font-black text-gray-900 uppercase tracking-tighter">Medicines</span>
                                        </a>
                                        <a routerLink="/find-doctors"
                                            class="p-5 bg-white rounded-3xl border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all group">
                                            <div
                                                class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-600 transition-colors">
                                                <i
                                                    class="fas fa-user-md text-blue-600 text-xl group-hover:text-white"></i>
                                            </div>
                                            <span
                                                class="block text-center text-xs font-black text-gray-900 uppercase tracking-tighter">Doctors</span>
                                        </a>
                                        <a routerLink="/lab-tests"
                                            class="p-5 bg-white rounded-3xl border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all group">
                                            <div
                                                class="w-12 h-12 bg-indigo-50 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-indigo-600 transition-colors">
                                                <i
                                                    class="fas fa-flask text-indigo-600 text-xl group-hover:text-white"></i>
                                            </div>
                                            <span
                                                class="block text-center text-xs font-black text-gray-900 uppercase tracking-tighter">Lab
                                                Tests</span>
                                        </a>
                                        <a routerLink="/ayurveda"
                                            class="p-5 bg-white rounded-3xl border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all group">
                                            <div
                                                class="w-12 h-12 bg-rose-50 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-rose-600 transition-colors">
                                                <i class="fas fa-leaf text-rose-600 text-xl group-hover:text-white"></i>
                                            </div>
                                            <span
                                                class="block text-center text-xs font-black text-gray-900 uppercase tracking-tighter">Ayurveda</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>

                <!-- Redesigned Pagination (Bottom of Results Column) -->
                <div *ngIf="!loading && hasResults && pagination.totalPages > 1"
                    class="py-6 px-4 sm:px-10 border-t border-gray-100 animate-fadeIn">
                    <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-6">

                        <!-- Page Info -->
                        <div class="flex items-center gap-3 sm:gap-4 order-2 md:order-1">
                            <div class="flex -space-x-2 shrink-0">
                                <div
                                    class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-emerald-100 border-2 border-white flex items-center justify-center text-emerald-600 text-[10px] sm:text-xs font-bold">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div
                                    class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-emerald-600 border-2 border-white flex items-center justify-center text-white text-[9px] sm:text-[10px] font-black uppercase">
                                    {{ pagination.total }}
                                </div>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs sm:text-[13px] font-black text-gray-900 tracking-tight">
                                    Showing {{ (pagination.page - 1) * pagination.limit + 1 }} - {{
                                    Math.min(pagination.page * pagination.limit, pagination.total) }}
                                </span>
                                <span
                                    class="text-[9px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest leading-tight">
                                    total items available
                                </span>
                            </div>
                        </div>

                        <!-- Pagination Controls -->
                        <div
                            class="flex items-center gap-1.5 sm:gap-2 order-1 md:order-2 w-full md:w-auto justify-center">
                            <!-- Prev -->
                            <button (click)="changePage((filters.page || 1) - 1)" [disabled]="(filters.page || 1) <= 1"
                                class="w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center bg-white border border-gray-100 rounded-xl text-xs font-bold text-gray-400 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-200 transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-sm">
                                <i class="fas fa-chevron-left"></i>
                            </button>

                            <!-- Pages Window -->
                            <div class="flex items-center gap-1 sm:gap-1.5 overflow-hidden">
                                <button *ngFor="let page of getPageRange()" (click)="changePage(page)"
                                    [class.bg-emerald-600]="(filters.page || 1) === page"
                                    [class.text-white]="(filters.page || 1) === page"
                                    [class.border-emerald-600]="(filters.page || 1) === page"
                                    [ngClass]="{'shadow-lg shadow-emerald-500/20': (filters.page || 1) === page}"
                                    class="w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center border border-gray-100 rounded-xl text-xs sm:text-[13px] font-black transition-all hover:border-emerald-500 hover:text-emerald-600 shadow-sm"
                                    [class.text-gray-400]="(filters.page || 1) !== page"
                                    [class.bg-white]="(filters.page || 1) !== page">
                                    {{ page }}
                                </button>
                            </div>

                            <!-- Next -->
                            <button (click)="changePage((filters.page || 1) + 1)"
                                [disabled]="(filters.page || 1) >= pagination.totalPages"
                                class="w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center bg-white border border-gray-100 rounded-xl text-xs font-bold text-gray-400 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-200 transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-sm">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Filter Sheet -->
    <div *ngIf="showMobileFilters" class="fixed inset-0 z-50 lg:hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" (click)="toggleMobileFilters()">
        </div>

        <!-- Sheet -->
        <div
            class="absolute bottom-0 left-0 right-0 bg-white rounded-t-[32px] max-h-[92vh] flex flex-col overflow-hidden animate-slideUp pb-[64px] shadow-2xl">
            <!-- Sheet Header -->
            <div
                class="px-6 py-4 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <div class="flex flex-col">
                    <h2 class="text-xl font-black text-gray-900 leading-tight">Filters</h2>
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">{{ activeFilterCount }}
                        active filters</span>
                </div>
                <button (click)="toggleMobileFilters()"
                    class="w-10 h-10 flex items-center justify-center bg-gray-100 rounded-full text-gray-900">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Sheet Content -->
            <div class="flex-1 overflow-y-auto px-6 py-8 space-y-10">
                <!-- Selectors Grouped -->
                <div class="grid grid-cols-1 gap-8">
                    <div class="filter-section">
                        <label
                            class="flex items-center gap-2 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-4">
                            <i class="fas fa-layer-group text-emerald-500"></i>
                            Product Type
                        </label>
                        <div class="relative">
                            <button (click)="toggleDropdown('mobileProductType', $event)"
                                class="w-full flex items-center justify-between gap-3 bg-gray-50 border border-gray-200 px-4 py-3.5 rounded-2xl text-sm font-bold text-gray-800 focus:ring-4 focus:ring-emerald-500/10 transition-all group">
                                <span class="truncate">{{ getSelectedLabel(productTypes, filters.type) }}</span>
                                <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-emerald-500 transition-transform"
                                    [class.rotate-180]="activeDropdown === 'mobileProductType'"></i>
                            </button>

                            <div *ngIf="activeDropdown === 'mobileProductType'" (click)="$event.stopPropagation()"
                                class="absolute left-0 right-0 mt-2 max-h-[250px] overflow-y-auto bg-white border border-gray-100 rounded-2xl shadow-2xl z-[60] animate-dropdown custom-scrollbar-hide">
                                <div class="p-1.5">
                                    <button *ngFor="let type of productTypes"
                                        (click)="selectOption('productType', type.value)"
                                        class="w-full text-left px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                        [class.bg-emerald-50]="filters.type === type.value"
                                        [class.text-emerald-700]="filters.type === type.value">
                                        {{ type.label }}
                                        <i *ngIf="filters.type === type.value" class="fas fa-check text-[10px]"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section" *ngIf="categories.length > 0">
                        <label
                            class="flex items-center gap-2 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-4">
                            <i class="fas fa-tag text-blue-500"></i>
                            Category
                        </label>
                        <div class="relative">
                            <button (click)="toggleDropdown('mobileCategory', $event)"
                                class="w-full flex items-center justify-between gap-3 bg-gray-50 border border-gray-200 px-4 py-3.5 rounded-2xl text-sm font-bold text-gray-800 focus:ring-4 focus:ring-blue-500/10 transition-all group">
                                <span class="truncate">{{ filters.category || 'All Categories' }}</span>
                                <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-blue-500 transition-transform"
                                    [class.rotate-180]="activeDropdown === 'mobileCategory'"></i>
                            </button>

                            <div *ngIf="activeDropdown === 'mobileCategory'" (click)="$event.stopPropagation()"
                                class="absolute left-0 right-0 mt-2 max-h-[250px] overflow-y-auto bg-white border border-gray-100 rounded-2xl shadow-2xl z-[60] animate-dropdown custom-scrollbar-hide">
                                <div class="p-1.5">
                                    <button (click)="selectOption('category', '')"
                                        class="w-full text-left px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                        [class.bg-blue-50]="!filters.category"
                                        [class.text-blue-700]="!filters.category">
                                        All Categories
                                        <i *ngIf="!filters.category" class="fas fa-check text-[10px]"></i>
                                    </button>
                                    <button *ngFor="let cat of categories" (click)="selectOption('category', cat)"
                                        class="w-full text-left px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                        [class.bg-blue-50]="filters.category === cat"
                                        [class.text-blue-700]="filters.category === cat">
                                        {{ cat }}
                                        <i *ngIf="filters.category === cat" class="fas fa-check text-[10px]"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label
                            class="flex items-center gap-2 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-4">
                            <i class="fas fa-microscope text-emerald-500"></i>
                            Medicine System
                        </label>
                        <div class="grid grid-cols-2 gap-2">
                            <button *ngFor="let m of medicineTypes" (click)="filters.medicineType = m.value"
                                [class.bg-emerald-600]="filters.medicineType === m.value"
                                [class.text-white]="filters.medicineType === m.value"
                                [class.border-emerald-600]="filters.medicineType === m.value"
                                [class.bg-white]="filters.medicineType !== m.value"
                                [class.text-gray-600]="filters.medicineType !== m.value"
                                [class.shadow-md]="filters.medicineType === m.value"
                                class="px-4 py-3 border border-gray-200 rounded-2xl text-xs font-black transition-all flex items-center justify-center gap-2 active:scale-95">
                                <i class="fas fa-check-circle" *ngIf="filters.medicineType === m.value"></i>
                                {{ m.label }}
                            </button>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label
                            class="flex items-center gap-2 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-4">
                            <i class="fas fa-star text-yellow-500"></i>
                            Minimum Rating
                        </label>
                        <div class="relative">
                            <button (click)="toggleDropdown('mobileRating', $event)"
                                class="w-full flex items-center justify-between gap-3 bg-gray-50 border border-gray-200 px-4 py-3.5 rounded-2xl text-sm font-bold text-gray-800 focus:ring-4 focus:ring-yellow-500/10 transition-all group">
                                <span class="truncate">{{ getSelectedLabel(ratingOptions, filters.minRating || 0)
                                    }}</span>
                                <i class="fas fa-chevron-down text-[10px] text-gray-400 group-hover:text-yellow-500 transition-transform"
                                    [class.rotate-180]="activeDropdown === 'mobileRating'"></i>
                            </button>

                            <div *ngIf="activeDropdown === 'mobileRating'" (click)="$event.stopPropagation()"
                                class="absolute left-0 right-0 mt-2 bg-white border border-gray-100 rounded-2xl shadow-2xl z-[60] animate-dropdown overflow-hidden">
                                <div class="p-1.5">
                                    <button *ngFor="let rating of ratingOptions"
                                        (click)="selectOption('rating', rating.value)"
                                        class="w-full text-left px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center justify-between"
                                        [class.bg-yellow-50]="filters.minRating === rating.value || (!filters.minRating && rating.value === 0)"
                                        [class.text-yellow-700]="filters.minRating === rating.value || (!filters.minRating && rating.value === 0)">
                                        <span class="flex items-center gap-2">
                                            <i class="fas fa-star text-yellow-400"></i>
                                            {{ rating.label }}
                                        </span>
                                        <i *ngIf="filters.minRating === rating.value || (!filters.minRating && rating.value === 0)"
                                            class="fas fa-check text-[10px]"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label
                            class="flex items-center gap-2 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-4">
                            <i class="fas fa-wallet text-xs"></i>
                            Price Range
                        </label>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1.5">
                                <span class="text-[10px] font-bold text-gray-400 ml-1">Minimum</span>
                                <div class="relative">
                                    <span
                                        class="absolute left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">₹</span>
                                    <input type="number" [(ngModel)]="filters.minPrice" placeholder="0"
                                        class="w-full pl-8 pr-4 py-3.5 bg-gray-50 border border-gray-200 rounded-2xl text-sm font-bold">
                                </div>
                            </div>
                            <div class="space-y-1.5">
                                <span class="text-[10px] font-bold text-gray-400 ml-1">Maximum</span>
                                <div class="relative">
                                    <span
                                        class="absolute left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">₹</span>
                                    <input type="number" [(ngModel)]="filters.maxPrice" placeholder="10000"
                                        class="w-full pl-8 pr-4 py-3.5 bg-gray-50 border border-gray-200 rounded-2xl text-sm font-bold">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sheet Footer -->
            <div class="p-6 bg-white border-t border-gray-100 sticky bottom-0 z-10 flex gap-4">
                <button (click)="clearFilters(); toggleMobileFilters()"
                    class="flex-1 px-4 py-4 border-2 border-rose-100 text-rose-500 font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-rose-50 transition-all">
                    Reset
                </button>
                <button (click)="applyFilters(); toggleMobileFilters()"
                    class="flex-[2] px-4 py-4 bg-gray-900 text-white font-black text-xs uppercase tracking-widest rounded-2xl hover:bg-black shadow-xl shadow-gray-200 transition-all">
                    Show Results
                </button>
            </div>
        </div>
    </div>

    <!-- Doctor Detail Modal -->
    <app-doctor-detail-modal *ngIf="selectedDoctorForDetails" [doctor]="selectedDoctorForDetails"
        [isOnline]="isDoctorOnline(selectedDoctorForDetails.id)" [isFree]="isFirstTimeUser"
        (close)="closeDoctorDetails()" (book)="openBookingFromDetails($event)">
    </app-doctor-detail-modal>

    <!-- Booking Modal -->
    <app-booking-modal *ngIf="selectedDoctor" [doctor]="selectedDoctor" [isOpen]="true" (close)="closeBooking()"
        (bookingConfirmed)="onBookingConfirmed($event)">
    </app-booking-modal>

    <!-- Product Detail Modal -->
    <app-product-detail-modal *ngIf="selectedProduct" [product]="selectedProduct" (close)="closeProductDetails()"
        (addToCart)="addToCartFromModal($event)">
    </app-product-detail-modal>

    <!-- Hospital Detail Modal -->
    <app-hospital-details-modal [hospital]="selectedHospital" [showModal]="showHospitalModal"
        [isFavorite]="selectedHospital ? isFavorite(selectedHospital.id) : false" (closeModal)="closeHospitalModal()"
        (toggleFavorite)="toggleFavorite($event, selectedHospital)">
    </app-hospital-details-modal>

    <!-- Herb Detail Modal -->
    <app-herb-detail *ngIf="selectedHerb" [herb]="selectedHerb" [isModal]="true" (close)="closeHerbDetails()">
    </app-herb-detail>

    <app-ayurveda-medicine-detail-modal *ngIf="selectedAyurvedaMedicine" [medicine]="selectedAyurvedaMedicine"
        (close)="closeAyurvedaMedicineDetails()">
    </app-ayurveda-medicine-detail-modal>

    <!-- Herb Loading Overlay -->
    <div *ngIf="isHerbLoading"
        class="fixed inset-0 z-[120] flex items-center justify-center bg-black/20 backdrop-blur-[2px]">
        <div class="p-8 bg-white rounded-3xl shadow-2xl flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
            <span class="text-xs font-black uppercase tracking-widest text-emerald-900">Loading Herb...</span>
        </div>
    </div>
</div>